<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Management</title>
    <link rel="stylesheet" href="/static/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
  </head>
  <body>
    {{template "header" .}}

    <main class="container">
      <div class="page-header">
        <h1>Team Management</h1>
        <div class="header-actions">
          <button class="btn btn-primary" id="createTeamBtn" type="button">
            <i class="fas fa-plus"></i>
            <span>Create Team</span>
          </button>
          <button class="btn btn-secondary" id="joinTeamBtn" type="button">
            <i class="fas fa-sign-in-alt"></i>
            <span>Join Team</span>
          </button>
        </div>
      </div>

      <!-- Create Team Section -->
      <section
        id="createTeamSection"
        class="team-section hidden"
        style="display: none"
      >
        <div class="section-header">
          <h2>Create New Team</h2>
          <button
            class="close-section-btn"
            id="closeCreateTeamBtn"
            type="button"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="createTeamForm" class="team-form" onsubmit="return false;">
          <div class="form-group">
            <label for="teamName">Team Name</label>
            <div class="input-with-icon">
              <i class="fas fa-users"></i>
              <input
                type="text"
                id="teamName"
                name="name"
                required
                minlength="3"
                maxlength="50"
                placeholder="Enter team name"
              />
            </div>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            <span>Create Team</span>
          </button>
        </form>
      </section>

      <!-- Join Team Section -->
      <section id="joinTeamSection" class="team-section hidden">
        <div class="section-header">
          <h2>Join Existing Team</h2>
          <button
            class="close-section-btn"
            onclick="toggleSection('joinTeamSection')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="joinTeamForm" class="team-form">
          <div class="form-group">
            <label for="teamCode">Team Code</label>
            <div class="input-with-icon">
              <i class="fas fa-key"></i>
              <input
                type="text"
                id="teamCode"
                name="code"
                required
                minlength="6"
                maxlength="6"
                placeholder="Enter team code"
              />
            </div>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-sign-in-alt"></i>
            <span>Join Team</span>
          </button>
        </form>
      </section>

      <!-- Teams List -->
      <section id="teamsList" class="teams-grid">
        {{range .Teams}}
        <div class="team-card" data-team-id="{{.ID}}">
          <div class="team-info">
            <h3>{{.Name}}</h3>
            <p class="team-code">Team Code: {{.Code}}</p>
          </div>

          <!-- Team Tasks Section -->
          <div class="team-todos">
            <div class="team-todos-header">
              <h4>Team Tasks</h4>
              <button
                class="btn btn-sm btn-primary"
                onclick="toggleTeamTodoForm({{.ID}})"
              >
                <i class="fas fa-plus"></i>
                <span>Add Task</span>
              </button>
            </div>

            <!-- Add Task Form -->
            <div id="teamTodoForm-{{.ID}}" class="team-todo-form hidden">
              <form
                class="todo-form"
                onsubmit="return createTeamTodo(event, {{.ID}})"
              >
                <div class="form-group">
                  <div class="input-with-icon">
                    <i class="fas fa-pencil-alt"></i>
                    <input
                      type="text"
                      name="title"
                      required
                      minlength="3"
                      maxlength="100"
                      placeholder="What needs to be done?"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <div class="input-with-icon">
                    <i class="fas fa-align-left"></i>
                    <textarea
                      name="description"
                      placeholder="Add a description (optional)"
                      class="todo-description"
                    ></textarea>
                  </div>
                </div>
                <div class="form-actions">
                  <button type="submit" class="btn btn-primary btn-sm">
                    <i class="fas fa-plus"></i>
                    <span>Add</span>
                  </button>
                  <button
                    type="button"
                    class="btn btn-secondary btn-sm"
                    onclick="toggleTeamTodoForm({{.ID}})"
                  >
                    <i class="fas fa-times"></i>
                    <span>Cancel</span>
                  </button>
                </div>
              </form>
            </div>

            <!-- Tasks List -->
            <div class="team-todos-list" id="teamTodosList-{{.ID}}">
              <!-- Team todos will be loaded here -->
            </div>
          </div>

          <div class="team-actions">
            <button class="btn btn-danger" onclick="deleteTeam({{.ID}})">
              <i class="fas fa-trash"></i>
              <span>Delete Team</span>
            </button>
          </div>
        </div>
        {{end}}
      </section>

      <!-- Error Message -->
      <div id="error-message" class="error-message hidden"></div>
    </main>

    {{template "footer" .}}
    <script src="/static/teams.js"></script>
  </body>
</html>
