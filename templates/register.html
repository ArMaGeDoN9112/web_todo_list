{{template "header" .}}

<div class="app-container">
  <main class="main-content">
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <h2>Register</h2>
          <p class="auth-subtitle">Create a new account</p>
        </div>

        <div id="error-message" class="error-message hidden"></div>

        <form id="register-form" class="auth-form">
          <div class="form-group">
            <label for="username">Username</label>
            <div class="input-with-icon">
              <i class="fas fa-user"></i>
              <input
                type="text"
                id="username"
                name="username"
                placeholder="Enter your username"
                required
                minlength="3"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <div class="input-with-icon">
              <i class="fas fa-envelope"></i>
              <input
                type="email"
                id="email"
                name="email"
                placeholder="Enter your email"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <div class="input-with-icon">
              <i class="fas fa-lock"></i>
              <input
                type="password"
                id="password"
                name="password"
                placeholder="Enter your password"
                required
                minlength="6"
              />
              <button
                type="button"
                class="password-toggle"
                aria-label="Toggle password visibility"
              >
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <div class="password-requirements">
              <small>Password must be at least 6 characters long</small>
            </div>
          </div>

          <div class="form-group">
            <label for="confirm-password">Confirm Password</label>
            <div class="input-with-icon">
              <i class="fas fa-lock"></i>
              <input
                type="password"
                id="confirm-password"
                name="confirm-password"
                placeholder="Confirm your password"
                required
                minlength="6"
              />
              <button
                type="button"
                class="password-toggle"
                aria-label="Toggle password visibility"
              >
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>

          <button type="submit" class="auth-button" id="register-button">
            <i class="fas fa-user-plus"></i>
            <span>Sign Up</span>
          </button>
        </form>

        <div class="auth-footer">
          <p>Already have an account?</p>
          <a href="/login" class="auth-link">Sign In</a>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
  document
    .getElementById("register-form")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value;
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirm-password").value;

      if (password !== confirmPassword) {
        const errorDiv = document.getElementById("error-message");
        errorDiv.textContent = "Passwords do not match";
        errorDiv.classList.remove("hidden");
        return;
      }

      try {
        const response = await fetch("/api/register", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ username, email, password }),
        });

        if (!response.ok) throw new Error("Registration failed");

        window.location.href = "/login";
      } catch (error) {
        const errorDiv = document.getElementById("error-message");
        errorDiv.textContent = error.message;
        errorDiv.classList.remove("hidden");
      }
    });

  // Toggle password visibility for both password fields
  document.querySelectorAll(".password-toggle").forEach((toggle) => {
    toggle.addEventListener("click", function () {
      const passwordInput = this.parentElement.querySelector("input");
      const icon = this.querySelector("i");

      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
      } else {
        passwordInput.type = "password";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
      }
    });
  });
</script>

{{template "footer" .}}
