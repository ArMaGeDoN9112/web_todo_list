{{template "header" .}}

<div class="app-container">
  <main class="main-content">
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <h2>Login</h2>
          <p class="auth-subtitle">Already have an account?</p>
        </div>

        <div id="error-message" class="error-message hidden"></div>

        <form id="login-form" class="auth-form">
          <div class="form-group">
            <label for="username">Username</label>
            <div class="input-with-icon">
              <i class="fas fa-user"></i>
              <input
                type="text"
                id="username"
                name="username"
                placeholder="Enter your username"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <div class="input-with-icon">
              <i class="fas fa-lock"></i>
              <input
                type="password"
                id="password"
                name="password"
                placeholder="Enter your password"
                required
                minlength="6"
              />
              <button
                type="button"
                class="password-toggle"
                aria-label="Toggle password visibility"
              >
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <div class="password-requirements">
              <small>Password must be at least 6 characters long</small>
            </div>
          </div>

          <button type="submit" class="auth-button" id="login-button">
            <i class="fas fa-sign-in-alt"></i>
            <span>Sign In</span>
          </button>
        </form>

        <div class="auth-footer">
          <p>Don't have an account?</p>
          <a href="/register" class="auth-link">Sign Up</a>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
  document
    .getElementById("login-form")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      try {
        const response = await fetch("/api/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ username, password }),
        });

        if (!response.ok) throw new Error("Invalid username or password");

        window.location.href = "/todos";
      } catch (error) {
        const errorDiv = document.getElementById("error-message");
        errorDiv.textContent = error.message;
        errorDiv.classList.remove("hidden");
      }
    });

  // Toggle password visibility
  document
    .querySelector(".password-toggle")
    .addEventListener("click", function () {
      const passwordInput = document.getElementById("password");
      const icon = this.querySelector("i");

      if (passwordInput.type === "password") {
        passwordInput.type = "text";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
      } else {
        passwordInput.type = "password";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
      }
    });
</script>

{{template "footer" .}}
